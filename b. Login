/* ================= GLOBAL DATA ================= */

/*
   These variables store the admin's username and password.
   They are global so all login-related functions can access them.
*/
char adminUsername[50] = "";
char adminPassword[50] = "";


/* ================= FILE PROCESSING ================= */

/*
   saveAdmin()
   This function saves the admin username and password
   into a file called "admin.txt".
   It is used after the admin registers or updates credentials.
*/
void saveAdmin() {
    FILE *fp = fopen("admin.txt", "w");
    if (fp) {
        fprintf(fp, "%s\n%s\n", adminUsername, adminPassword);
        fclose(fp);
    }
}

/*
   loadAdmin()
   This function loads the admin username and password
   from the "admin.txt" file when the program starts.
   This allows the login data to persist between runs.
*/
void loadAdmin() {
    FILE *fp = fopen("admin.txt", "r");
    if (fp) {
        fscanf(fp, "%s", adminUsername);
        fscanf(fp, "%s", adminPassword);
        fclose(fp);
    }
}


/* ================= ADMIN ================= */

/*
   adminLogin()
   This function handles the admin login process.
   It asks the user to input a username and password,
   then compares them with the stored admin credentials.
   If they match, login is successful.
*/
int adminLogin() {
    char u[50], p[50];
    clearScreen();
    printf("Username: ");
    scanf("%s", u);
    printf("Password: ");
    scanf("%s", p);

    if (strcmp(u, adminUsername) == 0 &&
        strcmp(p, adminPassword) == 0)
        return 1;

    printf("Login failed!\n");
    pauseScreen();
    return 0;
}

/*
   adminRegister()
   This function allows a new admin account to be created.
   The entered username and password are saved to a file
   so they can be used for future logins.
*/
void adminRegister() {
    clearScreen();
    printf("New Username: ");
    scanf("%s", adminUsername);
    printf("New Password: ");
    scanf("%s", adminPassword);
    saveAdmin();
    printf("Admin created!\n");
    pauseScreen();
}

/* ================= CUSTOMER ================= */

/*
   Fungsi customerLogin()
   Digunakan untuk login customer.
   Mengembalikan nilai:
   - 1 jika login berhasil
   - 0 jika login gagal
*/
int customerLogin() {
    char u[50], p[50];   // Menyimpan username dan password input user

    clearScreen();      // Membersihkan layar sebelum menampilkan menu login

    // Input username dan password dari user
    printf("Username: ");
    scanf("%s", u);

    printf("Password: ");
    scanf("%s", p);

    // Loop untuk mengecek semua customer yang terdaftar
    for (int i = 0; i < customerCount; i++) {

        // Bandingkan username dan password input dengan data customer
        if (!strcmp(u, customers[i].username) &&
            !strcmp(p, customers[i].password)) {

            // Simpan index customer yang berhasil login
            loggedCustomerIndex = i;
            return 1;   // Login berhasil
        }
    }

    // Jika tidak ada yang cocok
    printf("Login gagal!\n");
    pauseScreen();      // Pause agar user bisa membaca pesan
    return 0;           // Login gagal
}

/*
   Fungsi customerRegister()
   Digunakan untuk mendaftarkan customer baru
*/
void customerRegister() {
    clearScreen();  // Bersihkan layar sebelum input data

    // Input username dan password baru
    printf("New Username: ");
    scanf("%s", customers[customerCount].username);

    printf("New Password: ");
    scanf("%s", customers[customerCount].password);

    customerCount++;    // Tambah jumlah customer

    saveCustomers();    // Simpan data customer ke file

    printf("Customer berhasil didaftarkan!\n");
    pauseScreen();      // Pause agar user bisa membaca pesan
}
